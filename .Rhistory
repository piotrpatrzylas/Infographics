library(gridExtra)        # waffle chart
##############################
#       PRE-PROCESSING       #
#       &                    #
#       COLOURS              #
##############################
# general
this_year <- substr(as.character(Sys.Date()), 1, 4)
#title
if (info_type == 1) {
title_name1 <- "C. difficile"
italize_title <- T
title_name2 <- "Infection"
plot_name <- "C. difficile infection"
infographics_colour   <- "#E9994A"
infographics_colour2  <- "#002776"
} else if (info_type == 2) {
title_name1 <- "E. coli"
italize_title <- T
title_name2 <- "Bacteraemia"
plot_name <- "E. coli bacteraemia"
infographics_colour   <- "#00549F"
infographics_colour2  <- "#A4AEB5"
} else if (info_type == 3) {
title_name1 <- "Klebsiella spp."
italize_title <- T
title_name2 <- "Bacteraemia"
plot_name <- "Klebsiella spp. bacteraemia"
infographics_colour   <- "#00A551"
infographics_colour2  <- "#8CB8C6"
} else if (info_type == 4) {
title_name1 <- "MRSA"
italize_title <- F
title_name2 <- "Bacteraemia"
plot_name <- "MRSA bacteraemia"
infographics_colour   <- "#532D6D"
infographics_colour2  <- "#C51A4A"
} else if (info_type == 5) {
title_name1 <- "MSSA"
italize_title <- F
title_name2 <- "Bacteraemia"
plot_name <- "MSSA bacteraemia"
infographics_colour   <- "#00B092"
infographics_colour2  <- "#DAD7CB"
} else if (info_type == 6) {
title_name1 <- "Pseudomonas Aeruginosa"
italize_title <- T
title_name2 <- "Bactereamia"
plot_name <- "Pseudomonas Aeruginosa \nbacteraemia"
infographics_colour   <- "#822433"
infographics_colour2  <- "#EAAB00"
}
if (is.null(location_manually)) {
title_place <- "England"
} else {title_place = location_manually}
if (is.null(year_manually)) {
title_year <- paste0(as.numeric(this_year)-1, "/", this_year)
} else {title_year = paste0(as.numeric(year_manually) -1, "/", year_manually)}
#middle
switch(rhigh_factor,
"infant" = {
rhigh_factor <- "infants"
rhigh_age <- paste("(age < 1)")
},
"youth" = {
rhigh_factor <- "youth"
rhigh_age <- paste("(age 1 - 14)")
},
"young_adult" = {
rhigh_factor <- "adult"
rhigh_age <- paste("(age 15 - 44)")
},
"adult" = {
rhigh_factor <- "adult"
rhigh_age <- paste("(age 45 - 64)")
},
"older_adult" = {
rhigh_factor <- "adult"
rhigh_age <- paste("(age 65 - 74)")
},
"senior_adult" = {
rhigh_factor <- "adult"
rhigh_age <- paste("(age 75 - 84)")
},
"elder" = {
rhigh_factor <- "elderly"
rhigh_age <- paste("(age \U2265 85)")
})
switch(rlow_factor,
"infant" = {
rlow_factor <- "infant"
rlow_age <- paste("(age < 1)")
},
"youth" = {
rlow_factor <- "youth"
rlow_age <- paste("(age 1 - 14)")
},
"young_adult" = {
rlow_factor <- "adult"
rlow_age <- paste("(age 15 - 44)")
},
"adult" = {
rlow_factor <- "adult"
rlow_age <- paste("(age 45 - 64)")
},
"older_adult" = {
rlow_factor <- "adult"
rlow_age <- paste("(age 65 - 74)")
},
"senior_adult" = {
rlow_factor <- "adult"
rlow_age <- paste("(age 75 - 84)")
},
"elder" = {
rlow_factor <- "elderly"
rlow_age <- paste("(age \U2265 85)")
})
#bottom left
common_source <- as.character(doughnut_data[which.max(doughnut_data$count), 2])
#colours
background_colour     <- "#efe3af"
palette_fun = colorRampPalette(c(infographics_colour, infographics_colour2))
doughnut_palette <- palette_fun(dim(doughnut_data)[1])
# Copied from PHECHARTS
# red           822433    PSEUDO 1
# teal          00B092    MSSA 1
# navy          002776    C. difficile 2
# mushroom      DAD7CB    MSSA 2
# coolgrey      A4AEB5    E. coli 2
# peach         E9994A    C. difficile 1
# yellow        EAAB00    PSEUDO 2
# grass         00A551    Kleb 1
# sky           8CB8C6    Kleb 2
# moonlight     00549F    E. coli 1
# plum          532D6D    MRSA 1
# rose          C51A4A    MRSA 2
##############################
#       EXTERNAL FILES       #
##############################
logo_location <- "logo.jpg"
left_squarecircle <- "left square circle.jpg"
right_squarecircle <- "right square circle.jpg"
left_rectcircle <- "left rect cricle.jpg"
right_rectcircle <- "right rect cricle.jpg"
house <- "home.png"
hospital <- "hospital.png"
elder_man <- "elder_m.jpg"
elder_woman <- "elder_w.png"
adult_man <- "adult_m.png"
adult_woman <- "adult_w.png"
baby <- "baby.png"
people <- "people.png"
##############################
#   FIXED ELEMENTS           #
##############################
#EMPTY PLOT
empty_plot <- data.frame()
#BACKGROUND ELEMENTS
create_element <- function (image_file, output) {
r_object <- image_read(image_file)
r_object <- ggplot(empty_plot) + draw_image(r_object)
assign(output, r_object, env = .GlobalEnv)
}
create_house <- function (image_file, output) {
r_object <- image_read(image_file)
r_object <- image_fill(r_object, infographics_colour, point = "+500+500", fuzz = 90)
r_object <- ggplot(empty_plot) + draw_image(r_object)
assign(output, r_object, env = .GlobalEnv)
}
create_hospital <- function (image_file, output) {
r_object <- image_read(image_file)
r_object <- image_fill(r_object, infographics_colour2, point = "+60+250", fuzz = 90)
r_object <- image_fill(r_object, infographics_colour2, point = "+230+450", fuzz = 90)
r_object <- image_fill(r_object, infographics_colour2, point = "+410+450", fuzz = 90)
r_object <- image_fill(r_object, infographics_colour2, point = "+580+450", fuzz = 90)
r_object <- image_fill(r_object, infographics_colour2, point = "+750+450", fuzz = 90)
r_object <- image_fill(r_object, infographics_colour2, point = "+230+590", fuzz = 90)
r_object <- image_fill(r_object, infographics_colour2, point = "+410+590", fuzz = 90)
r_object <- image_fill(r_object, infographics_colour2, point = "+580+590", fuzz = 90)
r_object <- image_fill(r_object, infographics_colour2, point = "+750+590", fuzz = 90)
r_object <- image_fill(r_object, infographics_colour2, point = "+230+720", fuzz = 90)
r_object <- image_fill(r_object, infographics_colour2, point = "+750+720", fuzz = 90)
r_object <- ggplot(empty_plot) + draw_image(r_object)
assign(output, r_object, env = .GlobalEnv)
}
create_adultm <- function (image_file, output) {
r_object <- image_read(image_file)
r_object <- image_fill(r_object, background_colour, point = "+4+2", fuzz = 0)
r_object <- image_fill(r_object, infographics_colour, point = "+40+20", fuzz = 50)
r_object <- image_fill(r_object, infographics_colour, point = "+50+85", fuzz = 50)
r_object <- ggplot(empty_plot) + draw_image(r_object)
assign(output, r_object, env = .GlobalEnv)
}
create_adultw <- function (image_file, output) {
r_object <- image_read(image_file)
r_object <- image_fill(r_object, background_colour, point = "+10+10", fuzz = 0)
r_object <- image_fill(r_object, infographics_colour2, point = "+60+20", fuzz = 50)
r_object <- image_fill(r_object, infographics_colour2, point = "+60+100", fuzz = 50)
r_object <- ggplot(empty_plot) + draw_image(r_object)
assign(output, r_object, env = .GlobalEnv)
}
create_elderm <- function (image_file, output) {
r_object <- image_read(image_file)
r_object <- image_fill(r_object, background_colour, point = "+14+14", fuzz = 10)
r_object <- image_fill(r_object, infographics_colour, point = "+100+25", fuzz = 50)
r_object <- image_fill(r_object, infographics_colour, point = "+100+100", fuzz = 50)
r_object <- ggplot(empty_plot) + draw_image(r_object)
assign(output, r_object, env = .GlobalEnv)
}
create_elderw <- function (image_file, output) {
r_object <- image_read(image_file)
r_object <- image_fill(r_object, background_colour, point = "+14+14", fuzz = 10)
r_object <- image_fill(r_object, infographics_colour2, point = "+250+250", fuzz = 50)
r_object <- image_fill(r_object, infographics_colour2, point = "+250+50", fuzz = 50)
r_object <- ggplot(empty_plot) + draw_image(r_object)
assign(output, r_object, env = .GlobalEnv)
}
create_people <- function (image_file, output) {
r_object <- image_read(image_file)
r_object <- image_fill(r_object, background_colour, point = "+50+50", fuzz = 10)
r_object <- image_fill(r_object, infographics_colour, point = "+75+160", fuzz = 70)
r_object <- image_fill(r_object, infographics_colour, point = "+40+270", fuzz = 70)
r_object <- image_fill(r_object, infographics_colour, point = "+150+115", fuzz = 70)
r_object <- image_fill(r_object, infographics_colour, point = "+170+200", fuzz = 70)
r_object <- image_fill(r_object, infographics_colour, point = "+140+300", fuzz = 70)
r_object <- image_fill(r_object, infographics_colour, point = "+250+100", fuzz = 70)
r_object <- image_fill(r_object, infographics_colour, point = "+255+185", fuzz = 70)
r_object <- image_fill(r_object, infographics_colour, point = "+250+260", fuzz = 70)
r_object <- image_fill(r_object, infographics_colour, point = "+260+370", fuzz = 70)
r_object <- image_fill(r_object, infographics_colour, point = "+340+110", fuzz = 70)
r_object <- image_fill(r_object, infographics_colour, point = "+340+200", fuzz = 70)
r_object <- image_fill(r_object, infographics_colour, point = "+380+300", fuzz = 70)
r_object <- image_fill(r_object, infographics_colour, point = "+440+160", fuzz = 70)
r_object <- image_fill(r_object, infographics_colour, point = "+460+260", fuzz = 70)
r_object <- ggplot(empty_plot) + draw_image(r_object)
assign(output, r_object, env = .GlobalEnv)
}
create_baby <- function (image_file, output, fill) {
r_object <- image_read(image_file)
r_object <- image_fill(r_object, color = fill, point = "+260+100", fuzz = 70)
r_object <- image_fill(r_object, color = fill, point = "+260+230", fuzz = 70)
r_object <- image_fill(r_object, color = fill, point = "+175+360", fuzz = 70)
r_object <- image_fill(r_object, color = fill, point = "+340+360", fuzz = 70)
r_object <- ggplot(empty_plot) + draw_image(r_object)
assign(output, r_object, env = .GlobalEnv)
}
create_element(logo_location, "insert_logo")
create_element(left_squarecircle, "insert_left_squarecircle")
create_element(right_squarecircle, "insert_right_squarecircle")
create_element(left_rectcircle, "insert_left_rectcircle")
create_element(right_rectcircle, "insert_right_rectcircle")
create_people(people, "insert_people")
create_adultm(adult_man, "insert_am")
create_adultw(adult_woman, "insert_aw")
create_elderm(elder_man, "insert_em")
create_elderw(elder_woman, "insert_ew")
create_baby(baby, "insert_baby1", infographics_colour)
create_baby(baby, "insert_baby2", infographics_colour2)
low_male <- insert_am
low_female <- insert_aw
high_male <- insert_em
high_female <- insert_ew
create_house(house, "insert_house")
create_hospital(hospital, "insert_hospital")
crown_copyright <- paste0("\U00A9 Crown copyright ", this_year)
##############################
#        FIGURES             #
##############################
#top
top_plot <- ggplot(plot_data, aes(x = years, y = rate, group = 1)) +
geom_line(size = 2, colour = infographics_colour) +
ylim(0,max(plot_data$rate)) +
xlab("Financial Year") + ylab("Rate, per \n1000,000 population") +
ggtitle(paste("Trends in rates of ", plot_name)) +
theme(axis.title = element_text(color = infographics_colour)) +
theme(plot.title = element_text(color = infographics_colour, face = "bold", size = 12 )) +
theme(axis.line = element_line(color = infographics_colour)) +
theme (axis.text = element_text(color = infographics_colour)) +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
theme(panel.grid.major.y = element_line(color = infographics_colour)) +
theme(plot.margin = unit(c(0,0,0,0), "cm"))  +
theme(plot.background =  element_rect(fill = background_colour))
top_plot
ggsave(filename = "top.png", plot = top_plot, device = "png", path = getwd(), width = 5, height = 3)
create_element("top.png", "insert_plot")
#waffle plot - to be changed
waffle_element <- insert_am +
theme(plot.margin = unit(c(0, 0, 0, 0), "cm")) +
xlab(NULL) + ylab(NULL)
waffle_plot <- eval(parse(text = paste("plot_grid(",
paste(rep("waffle_element", times = rate_number), collapse = ","), ", scale = 1.1)")))
#bottom left
doughnut_plot <-
ggplot(doughnut_data, aes(x = 3, y = doughnut_data$count)) +
geom_bar(width = 1, stat = "identity", color = background_colour, fill = doughnut_palette) +
coord_polar(theta = 'y', start = 0) +
scale_y_continuous(breaks=cumsum(doughnut_data$count) - doughnut_data$count / 2) +
geom_text(aes(x = 3, label = paste0(count, "%")), size = 4, color = "white", position = position_stack(vjust = 0.5)) +
geom_text(aes( x = 4.4, label = source), size = 4, color = infographics_colour, position = position_stack(vjust = 0.5)) +
xlim(0.8, 4.5) +
theme_void() +
theme(legend.position = "none")
################################
################################
##                            ##
##        CREATE PDF          ##
##                            ##
################################
################################
create_infographics <- function() {
#PDF SETUP
grDevices::cairo_pdf("Info2.pdf", onefile = T, width = 8.27, height = 11.69)
grid::grid.newpage()
grid::pushViewport(grid::viewport(layout = grid::grid.layout(nrow = 117, ncol = 83, widths = unit(0.1, "inches"), heights = unit(0.1, "inches"))))
par(col = "blue")
#ELEMENTS
#logo
print(insert_logo, vp = useful::vplayout(x = 1:20, y = 1:25))
#title
title_length_combined <- str_length(paste(title_name1, title_name2))
if (title_length_combined <= 19) {
#short title
if (italize_title == T) {
grid::grid.text(title_name1, just = "left", y = unit(0.93, "npc"), x = unit(0.27, "npc"), gp = gpar(col = infographics_colour, fontsize = 44, fontface = "bold.italic"))
} else {
grid::grid.text(title_name1, just = "left", y = unit(0.93, "npc"), x = unit(0.27, "npc"), gp = gpar(col = infographics_colour, fontsize = 44, fontface = "bold"))
}
grid::grid.text(title_name2, just = "left", y = unit(0.93, "npc"), x = unit(0.53, "npc"), gp = gpar(col = infographics_colour, fontsize = 44, fontface = "bold"))
grid::grid.text(title_place, just = "left", y = unit(0.85, "npc"), x = unit(0.27, "npc"), gp = gpar(col = infographics_colour, fontsize = 44,  fontface = "bold"))
grid::grid.text(title_year, just = "left", y = unit(0.85, "npc"), x = unit(0.6, "npc"), gp = gpar(col = infographics_colour, fontsize = 44,  fontface = "bold"))
} else {
# long title
if (str_length(title_name1) <= 16) {
#long title with short first substring
if (italize_title == T) {
grid::grid.text(title_name1, just = "left", y = unit(0.95, "npc"), x = unit(0.35, "npc"), gp = gpar(col = infographics_colour, fontsize = 48, fontface = "bold.italic"))
} else {
grid::grid.text(title_name1, just = "left", y = unit(0.95, "npc"), x = unit(0.35, "npc"), gp = gpar(col = infographics_colour, fontsize = 48, fontface = "bold"))
}
grid::grid.text(title_name2, just = "left", y = unit(0.9, "npc"), x = unit(0.35, "npc"), gp = gpar(col = infographics_colour, fontsize = 40, fontface = "bold"))
grid::grid.text(title_place, just = "left", y = unit(0.85, "npc"), x = unit(0.35, "npc"), gp = gpar(col = infographics_colour, fontsize = 40,  fontface = "bold"))
grid::grid.text(title_year, just = "left", y = unit(0.85, "npc"), x = unit(0.65, "npc"), gp = gpar(col = infographics_colour, fontsize = 40,  fontface = "bold"))
} else {
#long title with longer first substring
if (italize_title == T) {
grid::grid.text(title_name1, just = "left", y = unit(0.93, "npc"), x = unit(0.28, "npc"), gp = gpar(col = infographics_colour, fontsize = 30, fontface = "bold.italic"))
} else {
grid::grid.text(title_name1, just = "left", y = unit(0.93, "npc"), x = unit(0.28, "npc"), gp = gpar(col = infographics_colour, fontsize = 30, fontface = "bold"))
}
grid::grid.text(title_name2, just = "left", y = unit(0.89, "npc"), x = unit(0.28, "npc"), gp = gpar(col = infographics_colour, fontsize = 30, fontface = "bold"))
grid::grid.text(title_place, just = "left", y = unit(0.85, "npc"), x = unit(0.28, "npc"), gp = gpar(col = infographics_colour, fontsize = 30,  fontface = "bold"))
grid::grid.text(title_year, just = "left", y = unit(0.85, "npc"), x = unit(0.55, "npc"), gp = gpar(col = infographics_colour, fontsize = 30,  fontface = "bold"))
}}
#background shapes
print(insert_left_squarecircle, vp = vplayout(x = 75:117, y = 1:46))
print(insert_right_squarecircle, vp = vplayout(x = 75:117, y = 38:83))
print(insert_left_rectcircle, vp = vplayout(x = 15:55, y = 1:83))
print(insert_right_rectcircle, vp = vplayout(x = 40:85, y = 1:83))
#top
grid::grid.text("Overall rate", just = "left", y = unit(0.79, "npc"), x = unit(0.1, "npc"), gp = gpar(col = infographics_colour, fontsize = 22, fontface = "bold"))
if (rate_number <= 9) {
grid::grid.text(rate_number, just = "left", y = unit(0.75, "npc"), x = unit(0.1, "npc"), gp = gpar(col = infographics_colour2, fontsize = 60, fontface = "bold"))
} else if (rate_number <= 99) {
grid::grid.text(rate_number, just = "left", y = unit(0.75, "npc"), x = unit(0.07, "npc"), gp = gpar(col = infographics_colour2, fontsize = 60, fontface = "bold"))
} else {
grid::grid.text(rate_number, just = "left", y = unit(0.75, "npc"), x = unit(0.06, "npc"), gp = gpar(col = infographics_colour2, fontsize = 48, fontface = "bold"))
}
grid::grid.text("people out of every", just = "left", y = unit(0.75, "npc"), x = unit(0.2, "npc"), gp = gpar(col = infographics_colour, fontsize = 12))
grid::grid.text("100,000", just = "left", y = unit(0.7, "npc"), x = unit(0.2, "npc"), gp = gpar(col = infographics_colour2, fontsize = 38))
grid::grid.text("will acquire an", just = "left", y = unit(0.67, "npc"), x = unit(0.2, "npc"), gp = gpar(col = infographics_colour, fontsize = 12))
if (title_length_combined <= 19) {
grid::grid.text(paste(title_name1, title_name2), just = "left", y = unit(0.65, "npc"), x = unit(0.2, "npc"), gp = gpar(col = infographics_colour, fontsize = 12))
} else {
grid::grid.text(paste(title_name1), just = "left", y = unit(0.65, "npc"), x = unit(0.2, "npc"), gp = gpar(col = infographics_colour, fontsize = 12))
grid::grid.text(paste(title_name2), just = "left", y = unit(0.63, "npc"), x = unit(0.2, "npc"), gp = gpar(col = infographics_colour, fontsize = 12))
}
if (rate_number <= 49) {
print(waffle_plot, vp = useful::vplayout(x = 35:45, y = 6:16))
} else {
print(insert_people, vp = useful::vplayout(x = 35:45, y = 6:16))
}
print(insert_plot, vp = useful::vplayout(x = 25:46, y = 35:70))
#middle
grid::grid.text(paste("Risk greater among", rhigh_factor), just = "left", y = unit(0.55, "npc"), x = unit(0.2, "npc"), gp = gpar(col = infographics_colour, fontsize = 28, fontface = "bold"))
grid::grid.text(paste(str_to_title(rlow_factor), "male rate"), just = "left", y = unit(0.51, "npc"), x = unit(0.12, "npc"), gp = gpar(col = infographics_colour, fontsize = 12))
if (rlow_factor == "infants") {
print(insert_baby1, vp = vplayout(x = 58:68, y = 5:15))
} else if (rlow_factor %in% c("youth", "adult")) {
print(insert_am, vp = vplayout(x = 58:68, y = 5:15))
} else if (rlow_factor == "elderly") {
print(insert_em, vp = vplayout(x = 58:68, y = 5:15))
}
grid::grid.text(rlow_malenumber, just = "left", y = unit(0.48, "npc"), x = unit(0.15, "npc"), gp = gpar(col = infographics_colour, fontsize = 36, fontface = "bold"))
grid::grid.text(paste(rlow_factor, "male"), just = "left", y = unit(0.45, "npc"), x = unit(0.15, "npc"), gp = gpar(col = infographics_colour, fontsize = 12))
grid::grid.text("out of every", just = "left", y = unit(0.43, "npc"), x = unit(0.15, "npc"), gp = gpar(col = infographics_colour, fontsize = 12))
grid::grid.text("100,000", just = "left", y = unit(0.41, "npc"), x = unit(0.15, "npc"), gp = gpar(col = infographics_colour, fontsize = 20))
grid::grid.text(rlow_age, just = "left", y = unit(0.39, "npc"), x = unit(0.15, "npc"), gp = gpar(col = infographics_colour, fontsize = 8))
grid::grid.text(paste(str_to_title(rlow_factor), "female rate"), just = "left", y = unit(0.51, "npc"), x = unit(0.3, "npc"), gp = gpar(col = infographics_colour2, fontsize = 12))
if (rlow_factor == "infants") {
print(insert_baby2, vp = vplayout(x = 58:68, y = 20:30))
} else if (rlow_factor %in% c("youth", "adult")) {
print(insert_aw, vp = vplayout(x = 58:68, y = 20:30))
} else if (rlow_factor == "elderly") {
print(insert_ew, vp = vplayout(x = 58:68, y = 20:30))
}
grid::grid.text(rlow_femnumber, just = "left", y = unit(0.48, "npc"), x = unit(0.35, "npc"), gp = gpar(col = infographics_colour2, fontsize = 36, fontface = "bold"))
grid::grid.text(paste(rlow_factor, "female"), just = "left", y = unit(0.45, "npc"), x = unit(0.35, "npc"), gp = gpar(col = infographics_colour2, fontsize = 12))
grid::grid.text("out of every", just = "left", y = unit(0.43, "npc"), x = unit(0.35, "npc"), gp = gpar(col = infographics_colour2, fontsize = 12))
grid::grid.text("100,000", just = "left", y = unit(0.41, "npc"), x = unit(0.35, "npc"), gp = gpar(col = infographics_colour2, fontsize = 20))
grid::grid.text(rlow_age, just = "left", y = unit(0.39, "npc"), x = unit(0.35, "npc"), gp = gpar(col = infographics_colour2, fontsize = 8))
grid::grid.text(paste(str_to_title(rhigh_factor), "male rate"), just = "left", y = unit(0.51, "npc"), x = unit(0.5, "npc"), gp = gpar(col = infographics_colour, fontsize = 12))
if (rhigh_factor == "infants") {
print(insert_baby1, vp = vplayout(x = 58:68, y = 38:48))
} else if (rhigh_factor %in% c("youth", "adult")) {
print(insert_am, vp = vplayout(x = 58:68, y = 38:48))
} else if (rhigh_factor == "elderly") {
print(insert_em, vp = vplayout(x = 58:68, y = 38:48))
}
grid::grid.text(rhigh_malenumber, just = "left", y = unit(0.48, "npc"), x = unit(0.56, "npc"), gp = gpar(col = infographics_colour, fontsize = 36, fontface = "bold"))
grid::grid.text(paste(rhigh_factor, "male"), just = "left", y = unit(0.45, "npc"), x = unit(0.56, "npc"), gp = gpar(col = infographics_colour, fontsize = 12))
grid::grid.text("out of every", just = "left", y = unit(0.43, "npc"), x = unit(0.56, "npc"), gp = gpar(col = infographics_colour, fontsize = 12))
grid::grid.text("100,000", just = "left", y = unit(0.41, "npc"), x = unit(0.56, "npc"), gp = gpar(col = infographics_colour, fontsize = 20))
grid::grid.text(rhigh_age, just = "left", y = unit(0.39, "npc"), x = unit(0.56, "npc"), gp = gpar(col = infographics_colour, fontsize = 8))
grid::grid.text(paste(str_to_title(rhigh_factor), "female rate"), just = "left", y = unit(0.51, "npc"), x = unit(0.7, "npc"), gp = gpar(col = infographics_colour2, fontsize = 12))
if (rhigh_factor == "infants") {
print(insert_baby2, vp = vplayout(x = 58:68, y = 55:65))
} else if (rhigh_factor %in% c("youth", "adult")) {
print(insert_aw, vp = vplayout(x = 58:68, y = 55:65))
} else if (rhigh_factor == "elderly") {
print(insert_ew, vp = vplayout(x = 58:68, y = 55:65))
}
grid::grid.text(rhigh_femnumber, just = "left", y = unit(0.48, "npc"), x = unit(0.77, "npc"), gp = gpar(col = infographics_colour2, fontsize = 36, fontface = "bold"))
grid::grid.text(paste(rhigh_factor, "female"), just = "left", y = unit(0.45, "npc"), x = unit(0.77, "npc"), gp = gpar(col = infographics_colour2, fontsize = 12))
grid::grid.text("out of every", just = "left", y = unit(0.43, "npc"), x = unit(0.77, "npc"), gp = gpar(col = infographics_colour2, fontsize = 12))
grid::grid.text("100,000", just = "left", y = unit(0.41, "npc"), x = unit(0.77, "npc"), gp = gpar(col = infographics_colour2, fontsize = 20))
grid::grid.text(rhigh_age, just = "left", y = unit(0.39, "npc"), x = unit(0.77, "npc"), gp = gpar(col = infographics_colour2, fontsize = 8))
#bottom left
grid::grid.text(common_source, just = "left", y = unit(0.3, "npc"), x = unit(0.07, "npc"), gp = gpar(col = infographics_colour, fontsize = 22))
grid::grid.text("infections are the most common source", just = "left", y = unit(0.27, "npc"), x = unit(0.07, "npc"), gp = gpar(col = infographics_colour, fontsize = 12))
print(doughnut_plot, vp = vplayout(x = 85:115, y = 7:37))
grid::grid.text(crown_copyright, just = "left", y = unit(0.03, "npc"), x = unit(0.07, "npc"), gp = gpar(col = infographics_colour, fontsize = 5))
#bottom right
grid::grid.text("Most cases are", just = "right", y = unit(0.31, "npc"), x = unit(0.92, "npc"), gp = gpar(col = infographics_colour, fontsize = 18))
grid::grid.text(most_cases, just = "right", y = unit(0.28, "npc"), x = unit(0.92, "npc"), gp = gpar(col = infographics_colour, fontsize = 24, fontface = "bold"))
print(insert_house, vp = vplayout(x = 87:102, y = 47:62))
grid::grid.text(paste0(community_percent, "%"), just = "left", y = unit(0.11, "npc"), x = unit(0.61, "npc"), gp = gpar(col = infographics_colour, fontsize = 28, fontface = "bold"))
grid::grid.text("< 2 days", just = "left", y = unit(0.08, "npc"), x = unit(0.61, "npc"), gp = gpar(col = infographics_colour, fontsize = 14, fontface = "bold"))
print(insert_hospital, vp = vplayout(x = 87:102, y = 62:77))
grid::grid.text(paste0(hospital_percent, "%"), just = "left", y = unit(0.11, "npc"), x = unit(0.8, "npc"), gp = gpar(col = infographics_colour2, fontsize = 28, fontface = "bold"))
grid::grid.text(paste(expression("\U2265 days")), just = "left", y = unit(0.08, "npc"), x = unit(0.8, "npc"), gp = gpar(col = infographics_colour2, fontsize = 14, fontface = "bold"))
grid::grid.text("For full report, please see", just = "left", y = unit(0.05, "npc"), x = unit(0.52, "npc"), gp = gpar(col = infographics_colour, fontsize = 5))
grid::grid.text("https://www.gov.uk/government/statistics/mrsa-mssa-and-e-coli-bacteraemia-and-c-difficile-infection-", just = "left", y = unit(0.04, "npc"), x = unit(0.52, "npc"), gp = gpar(col = infographics_colour, fontsize = 5))
grid::grid.text("annual-epidemiological-commentary", just = "left", y = unit(0.03, "npc"), x = unit(0.52, "npc"), gp = gpar(col = infographics_colour, fontsize = 5))
#CREATE PDF AND CLOSE DEVICE
grDevices::dev.off()
}
create_infographics()
doughnut_plot <-
ggplot(doughnut_data, aes(x = 3, y = doughnut_data$count)) +
geom_bar(width = 1, stat = "identity", color = background_colour, fill = doughnut_palette) +
coord_polar(theta = 'y', start = 0) +
scale_y_continuous(breaks=cumsum(doughnut_data$count) - doughnut_data$count / 2) +
geom_text(aes(x = 3, label = paste0(count, "%")), size = 4, color = "white", position = position_stack(vjust = 0.5)) +
geom_text(aes( x = 4.4, label = source), size = 4, color = infographics_colour, position = position_stack(vjust = 0.5)) +
xlim(0.8, 4.5) +
theme_void() +
theme(legend.position = "none")
doughnut_plot
doughnut_data$count
doughnut_data
doughnut_data[1, 2]
doughnut_data[1, ]
common_data <- doughnut_data[-common_filter, ]
common_filter <- c("Uknown", "Other")
common_data <- doughnut_data[-common_filter, ]
common_data <- doughnut_data[- grep (common_filter), ]
common_d
common_data
common_data <- doughnut_data[- grep (common_filter), ]
common_data <- doughnut_data[- grep (common_filter, doughnut_data$source), ]
common_data <- subset(doughnut_data == common_filter)
common_data
doughnut_data
common_filter <- c("Unknown", "Other")
common_data <- subset(doughnut_data == common_filter)
common_source <- as.character(doughnut_data[which.max(doughnut_data$count), 2])
common_data <- subset(doughnut_data == common_filter)
common_data
common_data <- subset(doughnut_data %in% common_filter)
common_data <- doughnut_data$source %in% common_filter
common_data
common_filter <- c("Unknown", "Other")
common_filer2 <- doughnut_data$source %in% common_filter
common_filer2
common_filer2 == 1
common_filer2[1]
common_filer2[2]
str(doughnut_data)
subset(doughnut_data, source == "Ohter")
subset(doughnut_data, source == 1)
common_filter <- c("Unknown", "Other")
comm <- subset(doughnut_data, source %in% common_filter)
comm
comm <- subset(doughnut_data, source %!in% common_filter)
common_filter <- c("Unknown", "Other")
comm <- subset(doughnut_data, !source %in% common_filter)
comm
common_source <- as.character(common_data[which.max(common_data$count), 2])
common_data <- subset(doughnut_data, !source %in% common_filter)
str(common_data)
common_source <- as.character(common_data[which.max(common_data$count), 2])
common_source
